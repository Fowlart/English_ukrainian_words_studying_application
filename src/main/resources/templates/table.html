<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body>
    <h1>WELCOME</h1>
    <!-- <img th:src="@{/images/Spring-Boot.png}"/> -->

    <h2>Translate: <span th:text="${wordTranslate.ukrword}"></span></span>
    </h2>

    <!-- Build "details" section  -->
    <script th:inline="javascript">
        var sw = 1;

        function switcher() {
            sw++;
            if (sw % 2 == 0) showDetails();
            else hideDetails();
        }

        function showDetails() {
            // How I pass a variable from Spring model to JavaScript variable?
            var ukrword = /*[[${wordTranslate.ukrword}]]*/ 'default';
            var engword = /*[[${wordTranslate.engword}]]*/ 'default';
            document.getElementById('details').hidden = false;
            document.getElementById('details').textContent = `${ukrword.toLocaleUpperCase()} - ${engword.toLocaleUpperCase()}`;
        }

        function hideDetails() {
            document.getElementById('details').hidden = true;
        }
    </script>
    <button type="button" onclick="switcher()">details</button>
    <p id="details" hidden='true' style="font-size: large; color:green;"></p>
    <!--END: Build "details" section  -->

    <br/><audio controls id="myAudio">
        <source type="audio/mpeg" th:src="${urla}">
    </audio>

    <!--Input field with script for processing -->
    <script th:inline="javascript">
        // POST request
        function sendWord() {
            var word = document.getElementById("WordInput").value;
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "http://localhost:8080/api/checkWord", true);
            xhttp.onreadystatechange = function() {
                console.log(`Response status: ${this.status}`);
                if (this.readyState == 4 && this.status == 200) {
                    // everithing OK
                    document.getElementById("WordInput").value = '';
                    document.getElementById('TranslateWarn').innerHTML = 'Translate:';
                } else if (this.readyState == 4 && this.status == 400) {
                    // empty line was sent
                    document.getElementById('TranslateWarn').innerHTML = 'Please provide a word: ';
                }
            }
            xhttp.send(word);
        }
    </script>
    <div>
        <p id='TranslateWarn'>Translate:</p><input id="WordInput" type="text" name="answer"></input>
        <p><button onclick="sendWord()">Send answer</button></p>
        </form>
    </div>
    <!--END:  Input field with script for processing -->
    <p>User: <span th:text="${user.name}" /></p>
    <p>Progress: <span th:text="${info.progress}" /></p>
    <p>Words count: <span th:text="${info.countOfWords}" /></p>
    <br/>

    <div id="demo">
        <button type="button" onclick="loadTable()">Load/reload table</button>
        <button type="button" onclick="cleanTable()">Shutdown table</button>
    </div>

    <!-- Table builder -->
    <table id="wordsTable" rules="cols" border="3" style="color:black; border-color:  black;"></table>
    <script th:inline="javascript">
        function cleanTable() {
            document.getElementById('wordsTable').innerHTML = '';
        }

        function loadTable() {
            var result;
            var table;
            var xhttp = new XMLHttpRequest();
            xhttp.open("GET", "http://localhost:8080/api/getTable", true);
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    table = '<tr><th>ID</th><th>ENG</th><th>UKR</th><th>RATIO</th></tr>';
                    result = JSON.parse(this.response); // will send object
                    console.log(result);
                    for (obj of result) {
                        table = table + '<tr>';
                        for (prop in obj) {
                            table = table + `<th>${obj[prop]}</th>`;
                        }
                        table = table = table + '</tr>';
                    }
                    document.getElementById('wordsTable').innerHTML = table;
                }
            };

            xhttp.send();
        }
    </script>
    <!-- END: Table builder -->
</body>

</html>